name: Pull Request

on:
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./src
    steps:
      - uses: actions/checkout@v2
      - name: âœ¨ Setup .NET
        uses: actions/setup-dotnet@v1
        with:
          dotnet-version: 6.0.x
      - name: ğŸ­ Restore dependencies
        run: dotnet restore
      - name: ğŸ§± Build
        run: dotnet build /p:Version='0.1.2-test1' /p:AssemblyVersion='0.1.2' /p:FileVersion='0.1.2' /p:InformationalVersion='0.1.2-test1' --no-restore
      - name: ğŸ“¦ NuGet Pack
        run: dotnet pack /p:PackageVersion='0.1.2-test1' --no-build
      - name: ğŸ›  Install tool
        run: |
          dotnet tool install scrap --global --add-source ./CommandLine/nupkg/ --version '0.1.2-test1'
      - name: âš™ Configure tool
        run: |
          scrap config /key=Scrap:Definitions /value=./definitions.json
          scrap config /key=Scrap:Database /value='Filename=./scrap.db;Connection=shared'
      - name: ğŸ› Test
        run: dotnet test --no-build --verbosity normal
